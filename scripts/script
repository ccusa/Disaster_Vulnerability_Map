library(dplyr)
library(magrittr)
library(rgdal)

# CDC data. Available at https://svi.cdc.gov/SVIDataToolsDownload.html
# replace User/Phil/DataKind/ with the path to the data on your machine
cdc_data <- readOGR(dsn = "/Users/Phil/DataKind/Shapefiles/County", layer = "SVI2014_US_CNTY", stringsAsFactors = F)

# Disaster likelyhood by fips. Available if you have accest to proprietary data
# replace User/Phil/DataKind/ with the path to the data on your machine
hazard_data <- read.csv("/Users/Phil/DataKind/hazard_data/hazard.csv",stringsAsFactors = F, colClasses = c("FIPS" = "character"))

# remove NA's from hazard data
hazard_data <- na.omit(hazard_data)

# join hazard data to shapefile
merge_data <- merge(cdc_data, hazard_data, by.x="FIPS", by.y="FIPS", all.x=T)

# getting data as data frame and set null values created by join to 0
t <- merge_data@data
t[125:135][is.na(t[125:135])] <- 0

# removing columns we don't want
t <- subset(t, select = !grepl("M.*|._UNINSUR |.._UNINSUR|State|County.*|MSA", colnames(t)))

# setting it back to a large SpatialPolygonsDataframe
merge_data@data <- t

# replace User/Phil/DataKind/Shapefiles with the path to your desired directory. 
# counties can be replaced with whatever name you'd like
writeOGR(merge_data, dsn="/Users/Phil/DataKind/Shapefiles/merge", layer="counties", driver="ESRI Shapefile", overwrite_layer = T)
